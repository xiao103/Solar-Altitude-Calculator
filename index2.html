<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤ªé˜³é«˜åº¦è§’ä¸é˜´å½±é•¿åº¦è®¡ç®—å™¨</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/suncalc@1.9.0/suncalc.min.js"></script>

    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 960px;
            margin-top: 2rem;
            margin-bottom: 2rem;
        }
        .card {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 0.5rem;
        }
        .card-header {
            background-color: #0d6efd;
            color: white;
            font-weight: bold;
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
        }
        .form-label {
            font-weight: 500;
        }
        #resultsTable th {
            position: sticky;
            top: 0;
            background-color: #e9ecef;
        }
        footer {
            margin-top: 2rem;
            text-align: center;
            color: #6c757d;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h5 class="card-header text-center py-3">
            â˜€ï¸ å¤ªé˜³é«˜åº¦è§’ä¸é˜´å½±é•¿åº¦è®¡ç®—å™¨
        </h5>
        <div class="card-body p-4">
            <div class="row g-3">
                <div class="col-md-6 col-lg-3">
                    <label for="latitude" class="form-label">çº¬åº¦ (Â°)</label>
                    <input type="number" class="form-control" id="latitude" value="25.03" step="0.01">
                </div>
                <div class="col-md-6 col-lg-3">
                    <label for="longitude" class="form-label">ç»åº¦ (Â°)</label>
                    <input type="number" class="form-control" id="longitude" value="121.56" step="0.01">
                </div>
                <div class="col-md-6 col-lg-3">
                    <label for="objectHeight" class="form-label">ç‰©ä½“é«˜åº¦ (mm)</label>
                    <input type="number" class="form-control" id="objectHeight" placeholder="å¯é€‰" min="0">
                </div>
                <div class="col-md-6 col-lg-3">
                    <label for="date" class="form-label">æ—¥æœŸ</label>
                    <input type="date" class="form-control" id="date">
                </div>
                <div class="col-12">
                    <label for="timezone" class="form-label">æ—¶åŒº</label>
                    <select class="form-select" id="timezone"></select>
                </div>
            </div>
        </div>
    </div>

    <div class="card mt-4">
        <h5 class="card-header text-center py-3">
            ğŸ“Š è®¡ç®—ç»“æœ
        </h5>
        <div class="card-body">
            <table class="table table-striped table-hover text-center" id="resultsTable">
                <thead>
                    <tr>
                        <th scope="col">æ—¶é—´ (æ‰€é€‰æ—¶åŒº)</th>
                        <th scope="col">å¤ªé˜³é«˜åº¦è§’ (Â°)</th>
                        <th scope="col">é˜´å½±é•¿åº¦ (mm)</th>
                    </tr>
                </thead>
                <tbody id="resultsBody"></tbody>
            </table>
        </div>
    </div>
</div>

<footer>
    <p>&copy; 2025 ç”Ÿæœ¬æ•™å…·ï¼ˆæµ™æ±Ÿï¼‰æœ‰é™å…¬å¸. All rights reserved.</p>
</footer>

<script>
    const latitudeInput = document.getElementById('latitude');
    const longitudeInput = document.getElementById('longitude');
    const dateInput = document.getElementById('date');
    const timezoneSelect = document.getElementById('timezone');
    const objectHeightInput = document.getElementById('objectHeight');
    const resultsBody = document.getElementById('resultsBody');

    const timezones = [
        { offset: -12, text: "UTC-12 | å›½é™…æ—¥æœŸå˜æ›´çº¿è¥¿" },
        { offset: -11, text: "UTC-11 | çº½åŸƒ" },
        { offset: -10, text: "UTC-10 | å¤å¨å¤·" },
        { offset: -9, text: "UTC-9 | é˜¿æ‹‰æ–¯åŠ " },
        { offset: -8, text: "UTC-8 | æ´›æ‰çŸ¶" },
        { offset: -7, text: "UTC-7 | ä¸¹ä½›" },
        { offset: -6, text: "UTC-6 | èŠåŠ å“¥" },
        { offset: -5, text: "UTC-5 | çº½çº¦" },
        { offset: -4, text: "UTC-4 | å“ˆåˆ©æ³•å…‹æ–¯" },
        { offset: -3, text: "UTC-3 | å·´è¥¿åˆ©äºš" },
        { offset: -2, text: "UTC-2 | å—ä¹”æ²»äºš" },
        { offset: -1, text: "UTC-1 | äºšé€Ÿå°”ç¾¤å²›" },
        { offset: 0, text: "UTC+0 | ä¼¦æ•¦" },
        { offset: 1, text: "UTC+1 | æŸæ—" },
        { offset: 2, text: "UTC+2 | å¼€ç½—" },
        { offset: 3, text: "UTC+3 | è«æ–¯ç§‘" },
        { offset: 4, text: "UTC+4 | è¿ªæ‹œ" },
        { offset: 5, text: "UTC+5 | å¡æ‹‰å¥‡" },
        { offset: 5.5, text: "UTC+5:30 | æ–°å¾·é‡Œ" },
        { offset: 6, text: "UTC+6 | è¾¾å¡" },
        { offset: 7, text: "UTC+7 | æ›¼è°·" },
        { offset: 8, text: "UTC+8 | åŒ—äº¬" },
        { offset: 9, text: "UTC+9 | ä¸œäº¬" },
        { offset: 10, text: "UTC+10 | æ‚‰å°¼" },
        { offset: 11, text: "UTC+11 | æ‰€ç½—é—¨ç¾¤å²›" },
        { offset: 12, text: "UTC+12 | å¥¥å…‹å…°" }
    ];

    function initialize() {
        timezones.forEach(tz => {
            const option = document.createElement('option');
            option.value = tz.offset;
            option.textContent = tz.text;
            timezoneSelect.appendChild(option);
        });
        timezoneSelect.value = "8";

        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        dateInput.value = `${yyyy}-${mm}-${dd}`;

        [latitudeInput, longitudeInput, dateInput, timezoneSelect, objectHeightInput].forEach(input => {
            input.addEventListener('input', calculateAndDisplay);
        });

        calculateAndDisplay();
    }

    function calculateAndDisplay() {
        const lat = parseFloat(latitudeInput.value);
        const lon = parseFloat(longitudeInput.value);
        const dateStr = dateInput.value;
        const tzOffset = parseFloat(timezoneSelect.value);
        const objectHeight = parseFloat(objectHeightInput.value);

        if (isNaN(lat) || isNaN(lon) || !dateStr) {
            resultsBody.innerHTML = `<tr><td colspan=\"3\" class=\"text-danger\">è¯·è¾“å…¥æœ‰æ•ˆçš„ç»çº¬åº¦å’Œæ—¥æœŸã€‚</td></tr>`;
            return;
        }

        resultsBody.innerHTML = '';
        const [year, month, day] = dateStr.split('-').map(Number);

        for (let hour = 0; hour < 24; hour++) {
            const utcTimestamp = Date.UTC(year, month - 1, day, hour, 0, 0) - (tzOffset * 3600 * 1000);
            const calculationDate = new Date(utcTimestamp);
            const sunPosition = SunCalc.getPosition(calculationDate, lat, lon);
            const altitudeRad = sunPosition.altitude;
            const altitudeDeg = altitudeRad * 180 / Math.PI;

            let shadowLength = 'â€”';
            if (!isNaN(objectHeight) && objectHeight > 0) {
                shadowLength = altitudeRad > 0
                    ? (objectHeight / Math.tan(altitudeRad)).toFixed(2)
                    : 'æ— ç©·é•¿';
            }

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${String(hour).padStart(2, '0')}:00</td>
                <td>${altitudeDeg.toFixed(2)} Â°</td>
                <td>${shadowLength}</td>
            `;
            resultsBody.appendChild(row);
        }
    }

    document.addEventListener('DOMContentLoaded', initialize);
</script>

</body>
</html>
