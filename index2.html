<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>太阳高度角与阴影长度计算器</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/suncalc@1.9.0/suncalc.min.js"></script>

    <style>
        body {
            background-color: #f8f9fa;
        }
        .container {
            max-width: 960px;
            margin-top: 2rem;
            margin-bottom: 2rem;
        }
        .card {
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
            border-radius: 0.5rem;
        }
        .card-header {
            background-color: #0d6efd;
            color: white;
            font-weight: bold;
            border-top-left-radius: 0.5rem;
            border-top-right-radius: 0.5rem;
        }
        .form-label {
            font-weight: 500;
        }
        #resultsTable th {
            position: sticky;
            top: 0;
            background-color: #e9ecef;
        }
        footer {
            margin-top: 2rem;
            text-align: center;
            color: #6c757d;
        }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <h5 class="card-header text-center py-3">
            ☀️ 太阳高度角与阴影长度计算器
        </h5>
        <div class="card-body p-4">
            <div class="row g-3">
                <div class="col-md-6 col-lg-3">
                    <label for="latitude" class="form-label">纬度 (°)</label>
                    <input type="number" class="form-control" id="latitude" value="25.03" step="0.01">
                </div>
                <div class="col-md-6 col-lg-3">
                    <label for="longitude" class="form-label">经度 (°)</label>
                    <input type="number" class="form-control" id="longitude" value="121.56" step="0.01">
                </div>
                <div class="col-md-6 col-lg-3">
                    <label for="objectHeight" class="form-label">物体高度 (mm)</label>
                    <input type="number" class="form-control" id="objectHeight" placeholder="可选" min="0">
                </div>
                <div class="col-md-6 col-lg-3">
                    <label for="date" class="form-label">日期</label>
                    <input type="date" class="form-control" id="date">
                </div>
                <div class="col-12">
                    <label for="timezone" class="form-label">时区</label>
                    <select class="form-select" id="timezone"></select>
                </div>
            </div>
        </div>
    </div>

    <div class="card mt-4">
        <h5 class="card-header text-center py-3">
            📊 计算结果
        </h5>
        <div class="card-body">
            <table class="table table-striped table-hover text-center" id="resultsTable">
                <thead>
                    <tr>
                        <th scope="col">时间 (所选时区)</th>
                        <th scope="col">太阳高度角 (°)</th>
                        <th scope="col">阴影长度 (mm)</th>
                    </tr>
                </thead>
                <tbody id="resultsBody"></tbody>
            </table>
        </div>
    </div>
</div>

<footer>
    <p>&copy; 2025 生本教具（浙江）有限公司. All rights reserved.</p>
</footer>

<script>
    const latitudeInput = document.getElementById('latitude');
    const longitudeInput = document.getElementById('longitude');
    const dateInput = document.getElementById('date');
    const timezoneSelect = document.getElementById('timezone');
    const objectHeightInput = document.getElementById('objectHeight');
    const resultsBody = document.getElementById('resultsBody');

    const timezones = [
        { offset: -12, text: "UTC-12 | 国际日期变更线西" },
        { offset: -11, text: "UTC-11 | 纽埃" },
        { offset: -10, text: "UTC-10 | 夏威夷" },
        { offset: -9, text: "UTC-9 | 阿拉斯加" },
        { offset: -8, text: "UTC-8 | 洛杉矶" },
        { offset: -7, text: "UTC-7 | 丹佛" },
        { offset: -6, text: "UTC-6 | 芝加哥" },
        { offset: -5, text: "UTC-5 | 纽约" },
        { offset: -4, text: "UTC-4 | 哈利法克斯" },
        { offset: -3, text: "UTC-3 | 巴西利亚" },
        { offset: -2, text: "UTC-2 | 南乔治亚" },
        { offset: -1, text: "UTC-1 | 亚速尔群岛" },
        { offset: 0, text: "UTC+0 | 伦敦" },
        { offset: 1, text: "UTC+1 | 柏林" },
        { offset: 2, text: "UTC+2 | 开罗" },
        { offset: 3, text: "UTC+3 | 莫斯科" },
        { offset: 4, text: "UTC+4 | 迪拜" },
        { offset: 5, text: "UTC+5 | 卡拉奇" },
        { offset: 5.5, text: "UTC+5:30 | 新德里" },
        { offset: 6, text: "UTC+6 | 达卡" },
        { offset: 7, text: "UTC+7 | 曼谷" },
        { offset: 8, text: "UTC+8 | 北京" },
        { offset: 9, text: "UTC+9 | 东京" },
        { offset: 10, text: "UTC+10 | 悉尼" },
        { offset: 11, text: "UTC+11 | 所罗门群岛" },
        { offset: 12, text: "UTC+12 | 奥克兰" }
    ];

    function initialize() {
        timezones.forEach(tz => {
            const option = document.createElement('option');
            option.value = tz.offset;
            option.textContent = tz.text;
            timezoneSelect.appendChild(option);
        });
        timezoneSelect.value = "8";

        const today = new Date();
        const yyyy = today.getFullYear();
        const mm = String(today.getMonth() + 1).padStart(2, '0');
        const dd = String(today.getDate()).padStart(2, '0');
        dateInput.value = `${yyyy}-${mm}-${dd}`;

        [latitudeInput, longitudeInput, dateInput, timezoneSelect, objectHeightInput].forEach(input => {
            input.addEventListener('input', calculateAndDisplay);
        });

        calculateAndDisplay();
    }

    function calculateAndDisplay() {
        const lat = parseFloat(latitudeInput.value);
        const lon = parseFloat(longitudeInput.value);
        const dateStr = dateInput.value;
        const tzOffset = parseFloat(timezoneSelect.value);
        const objectHeight = parseFloat(objectHeightInput.value);

        if (isNaN(lat) || isNaN(lon) || !dateStr) {
            resultsBody.innerHTML = `<tr><td colspan=\"3\" class=\"text-danger\">请输入有效的经纬度和日期。</td></tr>`;
            return;
        }

        resultsBody.innerHTML = '';
        const [year, month, day] = dateStr.split('-').map(Number);

        for (let hour = 0; hour < 24; hour++) {
            const utcTimestamp = Date.UTC(year, month - 1, day, hour, 0, 0) - (tzOffset * 3600 * 1000);
            const calculationDate = new Date(utcTimestamp);
            const sunPosition = SunCalc.getPosition(calculationDate, lat, lon);
            const altitudeRad = sunPosition.altitude;
            const altitudeDeg = altitudeRad * 180 / Math.PI;

            let shadowLength = '—';
            if (!isNaN(objectHeight) && objectHeight > 0) {
                shadowLength = altitudeRad > 0
                    ? (objectHeight / Math.tan(altitudeRad)).toFixed(2)
                    : '无穷长';
            }

            const row = document.createElement('tr');
            row.innerHTML = `
                <td>${String(hour).padStart(2, '0')}:00</td>
                <td>${altitudeDeg.toFixed(2)} °</td>
                <td>${shadowLength}</td>
            `;
            resultsBody.appendChild(row);
        }
    }

    document.addEventListener('DOMContentLoaded', initialize);
</script>

</body>
</html>
