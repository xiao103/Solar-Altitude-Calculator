<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>太阳高度角与影长计算</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: "Arial", sans-serif;
      background: #f0f8ff;
      padding: 30px;
      color: #333;
    }
    h1 {
      text-align: center;
      color: #0066cc;
    }
    .container {
      max-width: 800px;
      margin: auto;
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
    }
    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    input, select, button {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid #ccc;
    }
    th, td {
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #e6f2ff;
    }
    .footer {
      text-align: center;
      font-size: 0.9em;
      color: #666;
      margin-top: 40px;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>太阳高度角与阴影长度计算</h1>
  <label for="latitude">纬度（°）</label>
  <input type="number" id="latitude" placeholder="例如：30">

  <label for="longitude">经度（°）</label>
  <input type="number" id="longitude" placeholder="例如：120">

  <label for="timezone">时区（请选择城市）</label>
  <select id="timezone">
    <option value="8">中国标准时间（北京） GMT+8</option>
    <option value="9">日本标准时间（东京） GMT+9</option>
    <option value="1">中欧时间（柏林） GMT+1</option>
    <option value="-5">美国东部时间（纽约） GMT-5</option>
    <option value="0">格林威治标准时间（伦敦） GMT+0</option>
  </select>

  <label for="date">日期</label>
  <input type="date" id="date">

  <label for="height">物体高度（毫米，可选）</label>
  <input type="number" id="height" placeholder="例如：20">

  <button onclick="calculateSunAngles()">计算</button>

  <div id="result"></div>
</div>
<div class="footer">© 2025 太阳计算工具</div>

<script>
  function calculateSunAngles() {
    const lat = parseFloat(document.getElementById('latitude').value);
    const lon = parseFloat(document.getElementById('longitude').value);
    const tz = parseInt(document.getElementById('timezone').value);
    const dateInput = document.getElementById('date').value;
    const objHeight = parseFloat(document.getElementById('height').value);

    const date = dateInput ? new Date(dateInput) : new Date();
    const yyyy = date.getFullYear();
    const mm = date.getMonth();
    const dd = date.getDate();

    let table = `<table><tr><th>时间</th><th>太阳高度角 (°)</th>`;
    if (!isNaN(objHeight)) table += `<th>阴影长度 (mm)</th>`;
    table += `</tr>`;

    for (let hour = 0; hour <= 23; hour++) {
      const d = new Date(Date.UTC(yyyy, mm, dd, hour - tz));
      const jd = (d / 86400000.0) + 2440587.5;
      const n = jd - 2451545.0;
      const L = (280.46 + 0.9856474 * n) % 360;
      const g = (357.528 + 0.9856003 * n) % 360;
      const lambda = L + 1.915 * Math.sin(g * Math.PI / 180) + 0.020 * Math.sin(2 * g * Math.PI / 180);
      const epsilon = 23.439 - 0.0000004 * n;
      const alpha = Math.atan2(Math.cos(epsilon * Math.PI / 180) * Math.sin(lambda * Math.PI / 180), Math.cos(lambda * Math.PI / 180)) * 180 / Math.PI;
      const delta = Math.asin(Math.sin(epsilon * Math.PI / 180) * Math.sin(lambda * Math.PI / 180)) * 180 / Math.PI;

      const H = (((hour + 12) % 24) - 12) * 15 + lon - alpha;
      const h = Math.asin(
        Math.sin(lat * Math.PI / 180) * Math.sin(delta * Math.PI / 180) +
        Math.cos(lat * Math.PI / 180) * Math.cos(delta * Math.PI / 180) * Math.cos(H * Math.PI / 180)
      ) * 180 / Math.PI;

      const formattedTime = `${hour}:00`;
      table += `<tr><td>${formattedTime}</td><td>${h.toFixed(2)}</td>`;
      if (!isNaN(objHeight)) {
        const shadow = h > 0 ? (objHeight / Math.tan(h * Math.PI / 180)) : '—';
        table += `<td>${typeof shadow === 'number' ? shadow.toFixed(2) : shadow}</td>`;
      }
      table += `</tr>`;
    }

    table += `</table>`;
    document.getElementById('result').innerHTML = table;
  }
</script>
</body>
</html>
